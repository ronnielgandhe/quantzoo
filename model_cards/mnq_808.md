# MNQ 808 Strategy

## What

Systematic futures trading strategy ported from Pine Script v6. Uses SMA of True Range, ATR, and momentum indicators (MFI/RSI) with anchor recursion for entry signals. Implements one-bar adverse exit rule and legacy tick-based risk management.

## Data

**Requirements:**
- 15-minute OHLCV data with volume
- Minimum 250 bars for indicator calculation
- Session filtering (08:00-16:30)

**Format:**
```csv
time,open,high,low,close,volume
2023-01-01 08:00:00,4200.50,4205.25,4198.75,4203.00,1500
```

## Method

**Indicators:**
- SMA of True Range (10-period lookback)
- Average True Range (ATR)
- Money Flow Index (MFI) or Relative Strength Index (RSI)

**Entry Logic:**
- Calculate upper/lower bands: `upperBand = low - smaTR * atrMult`, `lowerBand = high + smaTR * atrMult`
- Anchor recursion: `anchor = momentum >= 50 ? min(upperBand, anchor[1]) : max(lowerBand, anchor[1])`
- Long signal: Close crosses above anchor[2]
- Short signal: Close crosses below anchor[2]

**Exit Logic:**
- Stop loss: Risk ticks * tick size (max 200 ticks)
- Trailing stop: ATR-based with trail multiplier
- One-bar adverse: Exit if position moves against entry on next bar

## Config

**File:** `configs/mnq_808.yaml`

**Key Parameters:**
- `atr_mult: 1.5` - ATR multiplier for bands
- `lookback: 10` - Period for SMA and momentum calculations
- `use_mfi: true` - Use MFI instead of RSI
- `risk_ticks_legacy: 150` - Maximum stop loss in ticks
- `contracts: 1` - Position size

## Metrics

**Latest Results** (350 bars, walk-forward):
- Total Return: 0.11%
- Sharpe Ratio: 0.561
- Maximum Drawdown: 8.36%
- Win Rate: 88.89%
- Profit Factor: 105.45
- Total Trades: 9

## Limitations

- Requires sufficient volatility for crossover signals
- Performance sensitive to ATR multiplier tuning
- Session filtering may miss overnight moves
- No microstructure modeling beyond basic slippage
- Legacy tick semantics may not match modern execution

## Reproduce

```bash
# Generate test data
python3 create_extended_data.py

# Run backtest
qz run -c configs/mnq_808.yaml -s 123

# Generate report
qz report -r <run_id>
```

**Expected Output:**
- Sharpe Ratio: ~0.5-0.6
- Win Rate: >80%
- Max Drawdown: <10%